/**
 * Template Metadata Generator
 * 
 * Generates template.json with placeholder definitions and project type information.
 */

export class MetadataGenerator {
  constructor() {
    // No initialization needed
  }

  async generateMetadata(analysis, options) {
    const { projectType, placeholders, targetFiles } = analysis;
    
    // Create placeholder definitions for template.json
    const placeholderDefinitions = placeholders.map(p => ({
      name: p.placeholder,
      description: this.getPlaceholderDescription(p.name),
      required: this.isPlaceholderRequired(p.name),
      default: this.getPlaceholderDefault(p.name)
    }));
    
    const metadata = {
      name: "Generated Template",
      description: `A ${projectType} project template generated by @m5nv/make-template`,
      setup: {
        supportedOptions: this.getSupportedOptions(projectType)
      },
      metadata: {
        type: projectType,
        version: "1.0.0",
        placeholders: placeholderDefinitions,
        files: targetFiles,
        createdBy: "@m5nv/make-template",
        createdAt: new Date().toISOString()
      }
    };
    
    return JSON.stringify(metadata, null, 2);
  }

  getPlaceholderDescription(placeholderName) {
    const descriptions = {
      'PROJECT_NAME': 'The name of the project',
      'PROJECT_DESCRIPTION': 'A brief description of the project',
      'AUTHOR': 'The author or maintainer of the project',
      'README_TITLE': 'The title shown in the README file',
      'WORKER_NAME': 'The name of the Cloudflare Worker',
      'CLOUDFLARE_ACCOUNT_ID': 'Your Cloudflare account ID',
      'BASE_URL': 'The base URL for the Vite application',
      'HTML_TITLE': 'The title shown in the browser tab'
    };
    
    return descriptions[placeholderName] || `Value for ${placeholderName}`;
  }

  isPlaceholderRequired(placeholderName) {
    const requiredPlaceholders = [
      'PROJECT_NAME',
      'WORKER_NAME',
      'CLOUDFLARE_ACCOUNT_ID'
    ];
    
    return requiredPlaceholders.includes(placeholderName);
  }

  getPlaceholderDefault(placeholderName) {
    const defaults = {
      'PROJECT_DESCRIPTION': null,
      'AUTHOR': null,
      'README_TITLE': null,
      'BASE_URL': '/',
      'HTML_TITLE': 'My App'
    };
    
    return defaults[placeholderName] || null;
  }

  getSupportedOptions(projectType) {
    const optionsByType = {
      'cf-d1': ['database', 'auth', 'cors'],
      'cf-turso': ['database', 'auth', 'cors'],
      'vite-react': ['typescript', 'testing', 'eslint', 'prettier'],
      'generic': ['testing', 'eslint', 'prettier', 'docs']
    };
    
    return optionsByType[projectType] || ['testing', 'docs'];
  }
}

export default MetadataGenerator;